const library = {
  stories: [
    {
      id: "lightning-god",
      title: "Lightning God",
      start: "chapter-1",
      chapters: {
        "chapter-1": {
          title: "Father and Son",
          body: `Anakia’s tea cup clicked softly against its saucer.

The terrace was shaded beneath the pergola, ivy climbing the white column beside her. A morning breeze came off the water and made the string lights sway—little glass lanterns that looked absurdly gentle for what was happening ten meters away.

In the garden, Ali rolled his shoulders once—bare chest catching the sun—then lifted his hands.

Across from him, Arlington stood with that Nightcrawler stillness: weight balanced, eyes half-lidded like he was listening to something behind the world.

Anakia raised her voice without raising her tone. “Honey. Be lenient with him. He’s our only son.”

Arlington didn’t even look at her. He looked at his father, jaw set.

Ali chuckled, and it wasn’t cruel—it was that warm, dangerous kind of amusement a Realm Lord wore like armor. “You assume I’ll hurt him.”

“I know your pride, Ali.” Anakia took a long sip, watching over the rim. “And I know his.”

Ali’s gaze flicked to Arlington’s hands.

“Daggers today?” Ali asked.

Arlington’s right hand blurred—empty space becoming steel as if he had pulled it from a pocket that didn’t exist. A training blade, dulled, but… Nightcrawler-dulled, which meant it could still leave a lesson in the skin.

“Daggers,” Arlington said. “Because you keep calling my gift a shortcut. I want you to say it to my face again.”

Ali smiled wider. “It’s a shortcut.”

Arlington vanished.

Not a sprint. Not a dodge.

A missing.

The air where he stood didn’t move. The grass didn’t bend. It was as if the world had never needed to account for him at all.

Ali’s head tilted a fraction—listening with something other than ears.

Then Ali shifted his left foot back.

A shadow snapped into existence behind him—Arlington reappearing mid-strike, dagger driving for the kidney with adolescent certainty.

Ali was already turning.

He caught Arlington’s wrist—not with strength, but with timing—twisting just enough that the blade pointed harmlessly away, then nudging the boy’s elbow up.

Arlington’s eyes widened.

Ali leaned close, voice low enough that it belonged to fathers, not rulers.

“I can feel the seam you’re using,” Ali murmured. “You think you’re the only one who grew up married to a Nightcrawler?”

Arlington snarled and phased again—this time only half his body slipping, shoulder and hips going translucent, trying to let Ali’s grip pass through him.

Ali didn’t hold tighter.

He let the wrist go.

Arlington stumbled—because the moment you stop resisting, the boy’s own momentum becomes the teacher.

He caught himself, straightened, cheeks flushed.

From the terrace, Anakia set her cup down slowly. “Ali.”

Ali didn’t look back. “He’s fine.”

Anakia’s voice stayed smooth, but a thread of warning ran through it. “You’re not teaching combat right now. You’re teaching him what it feels like to be humiliated.”

Arlington’s dagger re-formed in his hand, knuckles white. “I’m not humiliated.”

Ali lifted a brow. “Then stop trying to win and start trying to learn.”

Arlington blinked—offended by the implication.

“What do you want, Father?” Arlington snapped. “For me to kneel? For me to bow and say, yes, Realm Lord, while you—”

Ali’s eyes cooled.

The garden felt like it got quieter.

“Careful,” Ali said. Not loud. Not theatrical. Just… final.

Arlington swallowed, but stubbornness held him upright. “You treat me like an attendant.”

Anakia exhaled through her nose, amused despite herself. “That’s because you have your father’s mouth.”

Arlington threw a glance at her. “And yours.”

Anakia smiled sweetly. “Mine is refined. Yours is… in beta.”

Ali’s laugh burst out, quick and genuine, and for a heartbeat the tension loosened.

Then Arlington phased again, angry enough to be fast.

He didn’t go behind this time.

He went through.

For an instant, he appeared inside Ali’s line—too close for a normal step—dagger rising for a tight upward cut aimed at the ribs.

Ali’s hands moved like he’d rehearsed it in dreams.

He slapped the blade aside, caught Arlington’s forearm, and drove his own shoulder into the boy’s chest—not a strike, a check—sending Arlington skidding back a pace.

Arlington recovered immediately, but his breathing changed.

Ali noticed.

Of course he noticed.

“You’re pushing deeper,” Ali said.

Arlington’s eyes flicked, just once, to the pergola and the sea beyond—as if he was hearing a call from somewhere that didn’t have coordinates.

“You don’t know what it feels like,” Arlington muttered.

Ali’s face tightened. “I know exactly what it feels like. That’s why I’m stopping you.”

“You’re stopping me because you’re afraid I’ll become better than you.”

Ali stared at him for a long moment.

Then he spoke softly, and the softness was the dangerous part.

“I’m afraid you’ll do what Nightcrawlers always do when they’re sixteen and hungry,” Ali said. “You’ll confuse ability with permission.”

Arlington’s throat bobbed. “I can handle it.”

“You can’t,” Ali said flatly. “Because you think ‘handling it’ means not being scared.”

Anakia stood from her seat. Bare feet on cool stone. She walked to the terrace edge, leaning on the rail so she could see both their faces.

“Arl,” she called, voice gentler now, “look at me.”

Arlington didn’t want to.

But he did.

Anakia held his gaze. “Your father isn’t trying to break you. He’s trying to keep you from breaking yourself.”

Arlington’s lips pressed tight. “It’s always control, control, control.”

Ali nodded once, as if conceding a point. “Yes.”

Arlington scoffed. “That’s easy for you to say. You’re… you’re Outsider. You’re lightning. You’re—”

“A man who’s seen what happens when phasing goes wrong,” Ali cut in, and the air sharpened again. “You want the truth? The truth is your gift doesn’t just move you. It cuts a path.”

Arlington frowned. “So?”

“So every time you take that shortcut,” Ali said, stepping closer, “you leave a mark. You don’t see it. You don’t feel it—yet. But the world does.”

Anakia’s fingers tightened around the terrace rail.

Arlington’s voice dropped. “You’re talking about Phase Bleed.”

Ali’s stare didn’t waver. “I’m talking about you thinking you’re immortal because you can step sideways.”

Arlington’s jaw worked. Pride fighting fear.

“And what,” Arlington said, bitter now, “you want me to be normal?”

Ali’s face softened at the edges.

“No,” Ali said. “I want you to be alive.”

A beat.

Then Arlington’s eyes narrowed again, because sixteen-year-old boys don’t accept tenderness without stabbing it first.

“Alive,” Arlington echoed. “Like you’ll be alive if you keep treating me like a child.”

Ali’s hand rose—not to strike—just to point at Arlington’s chest.

“You’re not a child,” Ali said. “You’re a weapon that can choose what it protects.”

Arlington’s breath caught.

Anakia saw it—the moment that line landed. The moment her son almost understood, and hated that he almost understood.

Arlington lifted his dagger again.

“Fine,” he said. “Then teach me like I’m dangerous.”

Ali’s smile returned—smaller this time. “Good.”

Ali raised both hands, palms open.

“Rule,” Ali said.

Arlington answered instantly, as if he’d memorized it in resentment. “No phasing into flesh. No phasing into bone. No stepping beyond line-of-sight.”

“And?” Ali prompted.

Arlington hesitated.

Anakia’s voice cut in, calm as tea. “And if you feel the seam pulling you deeper, you stop. You don’t prove anything to anyone. Not even to yourself.”

Arlington’s eyes flicked to his mother, annoyed—

—but underneath it, grateful.

Ali nodded. “Again.”

Arlington vanished.

Ali didn’t move.

He waited—listening, feeling—

Then turned his head just slightly toward the lemon tree.

Arlington reappeared there, mid-lunge.

Ali stepped in and caught him.

This time, Ali didn’t twist him into a stumble.

He guided Arlington’s momentum past his own shoulder, letting the boy learn the line, letting him feel the difference between being stopped and being taught.

Arlington’s feet hit grass.

His dagger arm lowered a fraction.

Not surrender.

But… calibration.

From the terrace, Anakia finally let herself breathe.

“Better,” she murmured.

Ali heard her anyway.

He always did.

He glanced back once—eyes meeting hers.

“Lenient,” Ali said, as if the word tasted strange, “doesn’t mean soft.”

Anakia lifted her cup in a tiny toast. “No. It means you remember he’s yours.”

Ali looked at Arlington again.

And Arlington—stubborn, gifted, furious—lifted his chin.

“Again,” the boy said.

Ali nodded. “Again.”`,
          choices: [
            {
              text: "Launch a pre-emptive campaign to seize western farms.",
              next: "chapter-2-war",
            },
            {
              text: "Negotiate grain trade in exchange for military protection.",
              next: "chapter-2-trade",
            },
            {
              text: "Step down and leave the throne behind.",
              next: "chapter-2-abdicate",
            },
          ],
        },
        "chapter-2-war": {
          title: "War Council",
          body:
            "Your generals warn that morale is fragile and your armories are thin. How do you prepare for conflict?",
          choices: [
            {
              text: "Force peasants into labor and march immediately.",
              next: "ending-collapse",
            },
            {
              text: "Empower loyal knights with land, food, and command.",
              next: "ending-knights",
            },
            {
              text: "Send covert teams to steal enemy supplies.",
              next: "ending-stalemate",
            },
          ],
        },
        "chapter-2-trade": {
          title: "At Swordpoint",
          body:
            "The west offers protection, but their terms would cripple your treasury for years.",
          choices: [
            {
              text: "Accept the terms and buy time.",
              next: "ending-subjugation",
            },
            {
              text: "Threaten scorched fields unless they improve the deal.",
              next: "ending-fair-deal",
            },
          ],
        },
        "chapter-2-abdicate": {
          title: "The Empty Throne",
          body:
            "You leave by nightfall. The court fractures, but you escape before rivals can strike.",
          choices: [{ text: "Watch from exile.", next: "ending-exile" }],
        },
        "ending-collapse": {
          title: "Ending: Rebellion and Ruin",
          body:
            "Your exhausted army revolts, and the west invades a divided kingdom. The crown falls in a single winter.",
          choices: [],
        },
        "ending-knights": {
          title: "Ending: A Fragile Victory",
          body:
            "Your knights repel the invasion and secure new lands, but their power now rivals your own.",
          choices: [],
        },
        "ending-stalemate": {
          title: "Ending: Silent Advantage",
          body:
            "Night raids fill your stores and delay invasion. Peace returns briefly, but tension remains.",
          choices: [],
        },
        "ending-subjugation": {
          title: "Ending: Bread and Chains",
          body:
            "You preserve harvests for a few years, but dependency turns into occupation.",
          choices: [],
        },
        "ending-fair-deal": {
          title: "Ending: Uneasy Prosperity",
          body:
            "The west concedes fair prices. Your granaries recover, and your people survive another generation.",
          choices: [],
        },
        "ending-exile": {
          title: "Ending: Ghost of a King",
          body:
            "Civil war erupts without your rule. From afar, you wonder whether returning could save what remains.",
          choices: [],
        },
      },
    },
  ],
};

const chapterLabel = document.getElementById("chapterLabel");
const chapterTitle = document.getElementById("chapterTitle");
const chapterBody = document.getElementById("chapterBody");
const choicesEl = document.getElementById("choices");
const historyList = document.getElementById("historyList");
const ending = document.getElementById("ending");
const restartBtn = document.getElementById("restartBtn");
const libraryList = document.getElementById("libraryList");
const activeStoryLabel = document.getElementById("activeStoryLabel");

let activeStory = library.stories[0];
let currentChapterId = activeStory.start;
let path = [];

function setActiveStory(storyId) {
  const selectedStory = library.stories.find((story) => story.id === storyId);
  if (!selectedStory) {
    return;
  }

  activeStory = selectedStory;
  currentChapterId = activeStory.start;
  path = [];

  updateLibrary();
  updateHistory();
  renderChapter(currentChapterId);
}

function updateLibrary() {
  activeStoryLabel.textContent = `Currently reading: ${activeStory.title}`;

  libraryList.innerHTML = "";
  library.stories.forEach((story) => {
    const button = document.createElement("button");
    const isActive = story.id === activeStory.id;

    button.className = "library__item";
    button.type = "button";
    button.textContent = story.title;
    button.setAttribute("role", "listitem");
    button.setAttribute("aria-pressed", String(isActive));

    if (isActive) {
      button.classList.add("library__item--active");
    }

    button.addEventListener("click", () => {
      if (story.id !== activeStory.id) {
        setActiveStory(story.id);
      }
    });

    libraryList.append(button);
  });
}

function renderChapter(chapterId) {
  const chapter = activeStory.chapters[chapterId];
  if (!chapter) return;

  currentChapterId = chapterId;
  chapterLabel.textContent = `Chapter ${path.length + 1}`;
  chapterTitle.textContent = chapter.title;
  chapterBody.textContent = chapter.body;

  choicesEl.innerHTML = "";

  if (chapter.choices.length === 0) {
    ending.classList.remove("hidden");
  } else {
    ending.classList.add("hidden");
    chapter.choices.forEach((choice) => {
      const button = document.createElement("button");
      button.className = "choice-btn";
      button.type = "button";
      button.textContent = choice.text;
      button.setAttribute("role", "listitem");
      button.addEventListener("click", () => {
        path.push({ chapter: chapter.title, choice: choice.text });
        updateHistory();
        renderChapter(choice.next);
      });
      choicesEl.append(button);
    });
  }
}

function updateHistory() {
  historyList.innerHTML = "";

  path.forEach((entry) => {
    const li = document.createElement("li");
    li.textContent = `${entry.chapter} → ${entry.choice}`;
    historyList.append(li);
  });
}

restartBtn.addEventListener("click", () => {
  path = [];
  updateHistory();
  renderChapter(activeStory.start);
});

updateLibrary();
renderChapter(currentChapterId);
